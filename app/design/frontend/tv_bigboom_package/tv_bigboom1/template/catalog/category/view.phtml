<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2014 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php
/**
 * Category view template
 *
 * @see Mage_Catalog_Block_Category_View
 */
?>
<?php
$_helper = $this->helper('catalog/output');
$_category = $this->getCurrentCategory();
$_imgHtml = '';
if ($_imgUrl = $_category->getImageUrl()) {
    $_imgHtml = '<p class="category-image"><img src="' . $_imgUrl . '" alt="' . $this->escapeHtml($_category->getName()) . '" title="' . $this->escapeHtml($_category->getName()) . '" /></p>';
    $_imgHtml = $_helper->categoryAttribute($_category, $_imgHtml, 'image');
}
?>

<?php if ($_imgUrl): ?>
    <?php //echo $_imgHtml ?>
<?php endif; ?>
<div class="page-title category-title">
    <?php if ($this->IsRssCatalogEnable() && $this->IsTopCategory()): ?>
        <a href="<?php echo $this->getRssLink() ?>"
           class="link-rss"><?php echo $this->__('Subscribe to RSS Feed') ?></a>
    <?php endif; ?>
    <h1><?php echo $_helper->categoryAttribute($_category, $_category->getName(), 'name') ?></h1>
</div>

<?php echo $this->getMessagesBlock()->getGroupedHtml() ?>


<?php if ($_description = $this->getCurrentCategory()->getDescription()): ?>
    <div class="category-description std">
        <?php echo $_helper->categoryAttribute($_category, $_description, 'description') ?>
    </div>
<?php endif; ?>
<?php
$imgWidth = 295;
$columnCount = 5;
$currentCategory = Mage::getSingleton('catalog/layer')->getCurrentCategory();
$categories = $currentCategory->getCollection()
    ->addAttributeToSelect(array('name', 'image'))
    ->addAttributeToFilter('is_active', 1)
    ->addIdFilter($currentCategory->getChildren())
    ->addAttributeToSort('position');
?>
<?php if ($currentCategory->getChildren()): ?>
    <style>
        .category-products .category-products-grid{margin:0 -15px;}
        .category-products .category-products-grid li.item{
            display: inline-block;
            float:left;
            width:20%;
            padding: 0 15px;
            margin-bottom: 45px;}
        .category-products .category-products-grid li.item .product-category-wrap{
            transition: all 0.3s ease-in-out;
            -moz-transition: all 0.3s ease-in-out;
            -webkit-transition: all 0.3s ease-in-out;
            -o-transition: all 0.3s ease-in-out;
            -moz-box-shadow: 0 2px 5px rgba(0,0,0,.1);
            -webkit-box-shadow: 0 2px 5px rgba(0,0,0,.1);
            box-shadow: 0 2px 5px rgba(0,0,0,.1);}
        .category-products li.item figure{
            overflow: visible;
            position: relative;
            margin-bottom: 0;
            border-bottom-left-radius: 4px;
            border-bottom-right-radius: 4px;
            -webkit-transition: all 0.3s;
            -moz-transition: all 0.3s;
            -o-transition: all 0.3s;
            transition: all 0.3s;
        }
        .category-products figure.animated-overlay>a {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
        }
        .category-products figure.animated-overlay img {
            height: auto;
            max-width: 100%;
            transition: 1s all ease-in-out;
            -webkit-transition: 1s all ease-in-out;
            -moz-transition: 1s all ease-in-out;
            -ms-transition: 1s all ease-in-out;
            -o-transition: 1s all ease-in-out;
            z-index: 2;
            position: relative;
        }
        .category-products figure.animated-overlay figcaption{
            -webkit-transition: all 0.4s;
            -moz-transition: all 0.4s;
            -o-transition: all 0.4s;
            transition: all 0.4s;
            opacity: 0;
            -moz-opacity: 0;
            filter: alpha(opacity=0);
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: block;
            z-index: 3;
            -webkit-backface-visibility: hidden;
            -webkit-perspective: 1000;
            text-align: center;
            overflow: hidden;
            border-radius: inherit;
            background-color: #7eced5;
            background: -webkit-gradient(linear,left top,left bottom,color-stop(25%,rgba(126,206,213,0.60)),to(rgba(126,206,213,1.0)));
            background: -webkit-linear-gradient(top,rgba(126,206,213,0.60) 25%,rgba(126,206,213,1.0) 100%);
            background: linear-gradient(to bottom,rgba(126,206,213,0.60) 25%,rgba(126,206,213,1.0) 100%);
        }
        .category-products li.item figure figcaption .thumb-info {
            display: inline-block;
            width: 98.6%;
            margin-left: -3%;
            margin-bottom: 30px;
            padding: 0 30px;
            text-align: left;
            vertical-align: bottom;
            color: #fff;
            backface-visibility: hidden;
            bottom: 0!important;
            height: 100%!important;
        }
        .category-products figcaption .thumb-info-alt > i{
            display: block;
            text-align: center;
            box-sizing: content-box;
            font-size: 24px;
            line-height: 70px;
            height: 70px;
            width: 70px;
            top: 50%;
            margin-top: -35px;
            margin-left: -35px;
            left: 50%;
            position: absolute;
            border-radius: 50%;
            transform: translate(0,40px);
            background-color: #fff;
            color: #7eced5;
            transition-duration: 500ms;
            transition-property: transform;
        }
        .category-products li path{
            stroke-dasharray: 40;
            stroke-dashoffset: 44;
            -moz-transform-origin: 100%;
            -webkit-transform-origin: 100%;
            transform-origin: 100%;
            -webkit-transition: all 1s 0.3s cubic-bezier(0.25,0.45,0.43,0.97)!important;
            -moz-transition: all 1s 0.3s cubic-bezier(0.25,0.45,0.43,0.97)!important;
            -o-transition: all 1s 0.3s cubic-bezier(0.25,0.45,0.43,0.97)!important;
            transition: all 1s 0.3s cubic-bezier(0.25,0.45,0.43,0.97)!important;
            backface-visibility: hidden;
            stroke: #7eced5;
            color:#fff;
        }
        .category-products .product-cat-info {
            padding: 15px;
            border: 0;
            border-top-width: 0;
            border-radius: 0;
            text-align: center;
        }
        .category-products .product-cat-info h3 {
            margin: 0 0 4px;
            padding: 0;
            line-height: 150%;
            font-size: 14px;
            font-weight: bold;
            letter-spacing: normal;
            margin-bottom: 0;
            transition: all 0.3s ease-in-out;
            -moz-transition: all 0.3s ease-in-out;
            -webkit-transition: all 0.3s ease-in-out;
            -o-transition: all 0.3s ease-in-out;
        }
        .category-products .product-cat-info h3 a{ text-decoration: none;}
        .category-products li:hover figure {
            -moz-box-shadow: none;
            -webkit-box-shadow: none;
            box-shadow: none;
        }
        .category-products figure:hover img {
            opacity: 1!important;
            transform: none!important;
        }
        .category-products  figure.animated-overlay:hover figcaption {
            opacity: 1;
            -moz-opacity: 1;
            filter: alpha(opacity=100);
        }
        .category-products figure.animated-overlay:hover figcaption .thumb-info>i {
             transform: translate(0,0);
         }
        .category-products figure:hover .sf-hover-svg path{
            stroke-dashoffset: 0;
            -webkit-transition: all 1.5s 0.3s cubic-bezier(0.25,0.45,0.43,0.97)!important;
            -moz-transition: all 1.5s 0.3s cubic-bezier(0.25,0.45,0.43,0.97)!important;
            -o-transition: all 1.5s 0.3s cubic-bezier(0.25,0.45,0.43,0.97)!important;
            transition: all 1.5s 0.3s cubic-bezier(0.25,0.45,0.43,0.97)!important;
        }
        .category-products .category-products .category-products-grid li.item:hover .product-category-wrap {
            -moz-box-shadow: 0 10px 20px rgba(0,0,0,.1);
            -webkit-box-shadow: 0 10px 20px rgba(0,0,0,.1);
            box-shadow: 0 10px 20px rgba(0,0,0,.1);
        }
        .category-products #narrow-by-list dt:nth-child(n+2),#narrow-by-list dd:nth-child(n+3){display: none;}
        .category-products .block-layered-nav dd{border:none;}
        @media (min-width: 1200px){
            .category-products .products-grid li.item{}
            .category-products  figure.animated-overlay img{min-height: 150px;}
        }
    </style>
    <div class="category-products">
        <ul class="category-products-grid clearfix">
            <?php foreach ($categories as $category): ?>
                <li class="item">
                    <div class="product-category-wrap">
                        <figure class="animated-overlay">
                            <a href="<?php echo $category->getUrl() ?>" title="<?php echo $category->getName() ?>"
                               class="product-image"></a>
                            <img id="product-collection-image-<?php echo $category->getId(); ?>"
                                 src="<?php echo $category->getImageUrl() ?>" alt="<?php echo $category->getName() ?>"/>
                            <figcaption>
                                <div class="thumb-info thumb-info-alt">
                                    <i>
                                        <svg version="1.1" class="sf-hover-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px"
                                             height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
                                            <path fill="none" stroke="#444444" stroke-width="2" stroke-miterlimit="10" d="M2,12h20 M15,19l7-7l-7-7"></path>
                                        </svg>
                                    </i>
                                </div>
                            </figcaption>
                        </figure>
                        <div class="product-cat-info">
                            <h3 class="product-name">
                                <a href="<?php echo $category->getUrl() ?>" title="<?php echo $category->getName() ?>"><?php echo $category->getName() ?></a>
                            </h3>
                        </div>
                    </div>
                </li>
            <?php endforeach; ?>
        </ul>
    </div>
<?php else: ?>

    <?php if ($this->isContentMode()): ?>
        <?php echo $this->getCmsBlockHtml() ?>

    <?php elseif ($this->isMixedMode()): ?>
        <?php echo $this->getCmsBlockHtml() ?>
        <?php echo $this->getProductListHtml() ?>

    <?php else: ?>
        <?php echo $this->getProductListHtml() ?>
    <?php endif; ?>

<?php endif; ?>


